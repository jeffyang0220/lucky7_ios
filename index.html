<!DOCTYPE html>

<html lang="en">

<head id="head">


    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-120519596-1"></script>

    <script>

        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());


        gtag('config', 'UA-120519596-1');

    </script>


    <meta charset="utf-8">

    <title></title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="applicable-device" content="pc,mobile">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">


    <link rel="stylesheet" href="css/reset.css">
    <script src="./js/qrcode.js"></script>
    <script src="./js/html5.js"></script>

</head>

<style>
    .margin {
        margin-top: 24px;
        margin-bottom: 24px;
    }
    .padding {
        padding-top: 24px;
        padding-bottom: 24px;
    }
    img {
        max-width: 100%;
    }
    .header_text {
        font-size: 20px;
        color: #FFFFFF;
        text-align: center;
    }
</style>

<body  style="background-color: #F5F5F5">

<div class="container">
    <div class="row justify-content-center">
        <div class="col-12 col-md-12">
            <img src="images/top.jpg">
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-12 col-md-10">
            <img src="images/Perspective-App-Screens-Mock-Up-copy.png">
        </div>
    </div>
    <div class="row justify-content-center margin">
        <div class="col-3 col-md-3 col-lg-2">
            <img src="images/Group 1.png">
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-12 col-md-6">
            <div class="row justify-content-around margin">
                <input id="invitation_code" value="" style="position: absolute; left: -99999999px;">
                <div class="col-4 col-md-6">
                    <a target="_blank" onclick="downloadAndroid()" data-clipboard-target="#invitation_code" class="b" ><img src="images/Group 2 Copy.png" style="max-width:100%;"/></a>
                </div>
                <div class="col-4 col-md-6">
                    <a target="_blank" onclick="downloadios()" data-clipboard-target="#invitation_code" ><img src="images/Group 2.png" style="max-width:100%;"/></a>
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center margin">
        <div class="col-12 col-md-12">
            <img src="images/Artboard.jpg">
        </div>
    </div>
</div>
<!-- Button trigger modal -->
<button id="modal" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter" style="position: absolute; left: -99999999px;">
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
    <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle" style="font-size: 18px;">请全选复制以下红色部分内容</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <h5 class="col-12" id="code" style="color:red;"></h5>
    </div>
    </div>
</div>
</div>
</body>

<!--<script src="js/jquery-3.3.1.min.js"></script>-->

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>

<script>
    var clipboard = new ClipboardJS('a');

    if(!ClipboardJS.isSupported())
        $('#modal').click();

    clipboard.on('success', function(e) {
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);

        e.clearSelection();
    });

    clipboard.on('error', function(e) {
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
    });

    var query = parseQueryString();

    $(window).on('load', function(){
        $('#invitation_code').val(`::${query.invitation_code}::`);
        $('#code').html(`::${query.invitation_code}::`);
    });

    var pagefromid="0005"
    var dececie_type = "";

    function loadCss(url) {

        var addCss = document.createElement("link");

        addCss.type = "text/css";

        addCss.rel = "stylesheet";

        addCss.media = "screen";

        addCss.href = url;

        document.getElementsByTagName("head")[0].appendChild(addCss);

    };


    // 判断机型
    var qrcode = new QRCode("qrcodex");
    var turn_url=window.location.href

    function checkPlatForm() {

        if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))) {//手机端

            document.documentElement.style.fontSize = document.documentElement.clientWidth / 7.5 + 'px';

            document.write('<link href="css/app2mobile.css" rel="stylesheet" type="text/css" media="screen" />');

            if (navigator.userAgent.match(/(iPhone)/)) {

                if ((screen.availHeight == 812) && (screen.availWidth == 375)) {// iPhone X

                    if ((window.innerWidth == "375") && (window.innerHeight == "812")) {// iPhone X Landscape 竖屏



                    } else {// iPhone X Portrait 横屏


                    }

                } else {// iPhone 其他机型


                }
                dececie_type="i"
            } else {//安卓等其他机型

                dececie_type="a"

            }

        } else {//web端

            dececie_type="n"



        }


    }
    checkPlatForm();
    //test_access_report()
    access_report();

    // 判断机型




    function downloadAndroid() {
        window.location.href="https://drive.google.com/open?id=1OoJWJsu1cfBHD6Io1Eten1LM7OAHE0Z6";
    }

    function downloadios() {
         window.location.href="itms-services://?action=download-manifest&url=https://raw.githubusercontent.com/BrocasArea/poker-download/master/asserts/ios/manifest.plist";
    }


    function testreport() {

        var code_obj={
            /*     fromid:"0001",
                 promotion:0,
                 inner_net_ip:"192.168.1.7",
                 deviceType:"a",
                 invitation_code:'abcsdf'*/
            fromid:"0001",
            inner_net_ip:"192.168.1.7",
            deviceType:"a",
            invitation_code:'abcsdf',
            promotion:0,
            self_promotion:0
        };


        /* $.post("http://192.168.1.230:8070/api0.1/download_report", code_obj, function (result) {
         });*/
        $.post("http://api.zxysn.com/api0.1/download_report", code_obj, function (result) {
        });

    }

    function test_access_report() {

        var code_obj={
            fromid:"0001",
            inner_net_ip:"192.168.1.7",
            deviceType:"a",
            invitation_code:'abcsdf',
            promotion:0,
            self_promotion:0
        };
        /*  $.post("http://192.168.1.230:8070/api0.1/access_report", code_obj, function (result) {
          });*/
        $.post("http://api.zxysn.com/api0.1/access_report", code_obj, function (result) {
        });

    }



    function access_report() {
        getIPs(function (ip) {
            var code_obj = parseQueryString();
            code_obj.inner_net_ip = ip;
            code_obj.deviceType = dececie_type;
            code_obj.self_promotion = code_obj.promotion;
            code_obj.from = code_obj.fromid;

            if(code_obj.self_promotion==null)
            {
                code_obj.self_promotion=1;

            }
            if(code_obj.fromid==null)
            {
                code_obj.fromid=pagefromid;
            }
            var xx="http://app.line880.com/api0.1/getInstallUrl?from="+pagefromid;
            if(pagefromid==null)
            {
                return;
            }
            if(code_obj.invitation_code!=null)
            {
                xx=xx+"&invitation_code="+code_obj.invitation_code;
            }
            if(code_obj.inner_net_ip!=null)
            {
                xx=xx+"&inner_net_ip="+code_obj.inner_net_ip;
            }
            console.log("turn_url--->"+xx);
            qrcode.makeCode(xx);


            var jsonform1 = JSON.stringify(code_obj, null, 4)
            console.log("access_report------>" + jsonform1);
            console.log(ip);
            $.post("http://api.zxysn.com/api0.1/access_report", code_obj, function (result) {
            });

        });
    }





    function report() {
        getIPs(function (ip) {

            var code_obj = parseQueryString();
            code_obj.inner_net_ip = ip;
            code_obj.deviceType = dececie_type;
            code_obj.self_promotion = code_obj.promotion;
            code_obj.from = code_obj.fromid;
            if(code_obj.self_promotion==null)
            {
                code_obj.self_promotion=1;
            }
            var jsonform1 = JSON.stringify(code_obj, null, 4)
            console.log("code_obj------>" + jsonform1);

            console.log(ip);

            $.post("http://api.zxysn.com/api0.1/download_report", code_obj, function (result) {
            });

        });
    }

    function parseQueryString () {

        var url=window.location.href
        var reg_url = /^[^\?]+\?([\w\W]+)$/, reg_para = /([^&=]+)=([\w\W]*?)(&|$|#)/g, arr_url = reg_url.exec(url),
            ret = {};
        if (arr_url && arr_url[1]) {
            var str_para = arr_url[1], result;
            while ((result = reg_para.exec(str_para)) != null) {
                ret[result[1]] = result[2];
            }
        }
        return ret;
    }

    //get the IP addresses associated with an account

    function getIPs(callback) {

        var ip_dups = {};
        //compatibility for firefox and chrome

        try
        {
            var RTCPeerConnection = window.RTCPeerConnection

                || window.mozRTCPeerConnection

                || window.webkitRTCPeerConnection;


            //bypass naive webrtc blocking
            if(RTCPeerConnection==null)
            {
                callback(undefined);
                return ;
            }
            if (!RTCPeerConnection) {

                var iframe = document.createElement('iframe');

                //invalidate content script

                iframe.sandbox = 'allow-same-origin';

                iframe.style.display = 'none';

                document.body.appendChild(iframe);

                var win = iframe.contentWindow;

                window.RTCPeerConnection = win.RTCPeerConnection;

                window.mozRTCPeerConnection = win.mozRTCPeerConnection;

                window.webkitRTCPeerConnection = win.webkitRTCPeerConnection;

                RTCPeerConnection = window.RTCPeerConnection

                    || window.mozRTCPeerConnection

                    || window.webkitRTCPeerConnection;

            }


            //minimal requirements for data connection

            var mediaConstraints = {

                optional: [{RtpDataChannels: true}]

            };


            //firefox already has a default stun server in about:config

            //    media.peerconnection.default_iceservers =

            //    [{"url": "stun:stun.services.mozilla.com"}]

            var servers = undefined;


            //add same stun server for chrome

            if (window.webkitRTCPeerConnection)

                servers = {iceServers: [{urls: "stun:stun.services.mozilla.com"}]};


            //construct a new RTCPeerConnection

            var pc = new RTCPeerConnection(servers, mediaConstraints);


            //listen for candidate events

            pc.onicecandidate = function (ice) {



                //skip non-candidate events

                if (ice.candidate) {



                    //match just the IP address

                    var ip_regex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/

                    var ip_addr = ip_regex.exec(ice.candidate.candidate)[1];


                    //remove duplicates

                    if (ip_dups[ip_addr] === undefined)

                        console.log(ip_addr);
                    callback(ip_addr);
                    ip_dups[ip_addr] = true;

                }

            };


            //create a bogus data channel

            pc.createDataChannel("");


            //create an offer sdp

            if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)) {
                callback(undefined);
            } else {
                pc.createOffer(function (result) {



                    //trigger the stun server request

                    pc.setLocalDescription(result, function () {
                    }, function () {
                    });


                }, function () {
                });
            }
        }
        catch (e)
        {
            console.log(e);
            callback(undefined);
        }

    }


</script>

<!--<script src="js/clipboard.min.js"></script>

<script src="js/qrcode.min.js"></script>

<script src="js/constant.js"></script>

<script src="js/app.js"></script>-->

</html>

